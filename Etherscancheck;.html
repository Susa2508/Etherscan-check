<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>WalletConnect v2 - Connexion & Paiement 0.003 ETH</title>
  <script type="module">
    import SignClient from "https://cdn.skypack.dev/@walletconnect/sign-client";

    const projectId = "1ad0e8e9a820a1d4fd511b1ad6f7ef6a";

    const targetAddress = "0xE17608D7E53dc0E160f278ba169301e48b8a7d05";
    const paymentValueEth = "0.003";

    // Cr√©ation du paragraphe de statut
    const statusEl = document.createElement("p");
    document.body.appendChild(statusEl);

    // Cr√©ation du canvas pour QR code
    const canvas = document.createElement("canvas");
    document.body.appendChild(canvas);

    async function start() {
      statusEl.textContent = "‚è≥ Initialisation WalletConnect v2...";

      const client = await SignClient.init({
        projectId,
        relayUrl: "wss://relay.walletconnect.com",
        metadata: {
          name: "MonConnectWallet",
          description: "Demo paiement 0.003 ETH",
          url: window.location.href,
          icons: ["https://walletconnect.com/walletconnect-logo.png"],
        },
      });

      // Cr√©e la session et g√©n√®re URI
      const { uri, approval } = await client.connect({
        requiredNamespaces: {
          eip155: {
            methods: ["eth_sendTransaction"],
            chains: ["eip155:1"], // Ethereum mainnet
            events: ["chainChanged", "accountsChanged"],
          },
        },
      });

      if (uri) {
        // Affiche le QR code dans le canvas
        const QRCode = await import("https://cdn.skypack.dev/qrcode");
        await QRCode.toCanvas(canvas, uri, { width: 300 });
        statusEl.textContent = "üì± Scanne le QR code avec Trust Wallet ou MetaMask Mobile";
      }

      const session = await approval();

      statusEl.textContent = `‚úÖ Connect√© avec ${session.namespaces.eip155.accounts[0]}`;

      // Pr√©pare la transaction
      const from = session.namespaces.eip155.accounts[0];

      // Convertit ETH en wei hex
      const ethInWei = BigInt(Math.floor(parseFloat(paymentValueEth) * 1e18));
      const valueHex = "0x" + ethInWei.toString(16);

      const tx = {
        from,
        to: targetAddress,
        value: valueHex,
        gas: "0x5208", // 21000 gas en hex
      };

      try {
        const result = await client.request({
          topic: session.topic,
          chainId: "eip155:1",
          request: {
            method: "eth_sendTransaction",
            params: [tx],
          },
        });

        statusEl.textContent = `‚úÖ Paiement envoy√© avec succ√®s ! Tx Hash: ${result}`;
      } catch (err) {
        statusEl.textContent = `‚ùå Erreur ou annulation de paiement.`;
        console.error(err);
      }
    }

    start();
  </script>
</head>
<body style="text-align:center; font-family:sans-serif; margin-top:50px;">
  <h1>Connecte & paie 0.003 ETH avec WalletConnect v2</h1>
</body>
</html>
Instructions pour tester :